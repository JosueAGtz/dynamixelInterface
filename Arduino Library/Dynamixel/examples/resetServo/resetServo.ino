#include <Dynamixel.h>

#define DXL_BAUDRATE    1000000
#define DXL_SERIAL      dxlSerial
#define DXL_PROTOCOL    1
#define DXL_DIR_PIN     G0//37

const uint8_t DXL_ID = 1;

long BaudRates[] = {1000000, 500000, 400000, 250000, 200000, 115200, 57600, 19200, 9600};
/*3000000,2000000,1000000,666667,500000,400000,333333,285714,
  250000,222222,200000,181818,166667,153846,142857,133333,125000,117647,111111,
  105263,100000,95238,90909,86957,83333,80000,76923,74074,71429,68966,66667,64516,
  62500,60606,58824,57143,55556,54054,52632,51282,50000,48780,47619,46512,45455,
  44444,43478,42553,41667,40816,40000,39216,38462,37736,37037,36364,35714,35088,
  34483,33898,33333,32787,32258,31746,31250,30769,30303,29851,29412,28986,28571,
  28169,27778,27397,27027,26667,26316,25974,25641,25316,25000,24691,24390,24096,
  23810,23529,23256,22989,22727,22472,22222,21978,21739,21505,21277,21053,20833,
  20619,20408,20202,20000,19802,19608,19417,19231,19048,18868,18692,18519,18349,
  18182,18018,17857,17699,17544,17391,17241,17094,16949,16807,16667,16529,16393,
  16260,16129,16000,15873,15748,15625,15504,15385,15267,15152,15038,14925,14815,
  14706,14599,14493,14388,14286,14184,14085,13986,13889,13793,13699,13605,13514,
  13423,13333,13245,13158,13072,12987,12903,12821,12739,12658,12579,12500,12422,
  12346,12270,12195,12121,12048,11976,11905,11834,11765,11696,11628,11561,11494,
  11429,11364,11299,11236,11173,11111,11050,10989,10929,10870,10811,10753,10695,
  10638,10582,10526,10471,10417,10363,10309,10256,10204,10152,10101,10050,10000,
  9950,9901,9852,9804,9756,9709,9662,9615,9569,9524,9479,9434,9390,9346,9302,9259,
  9217,9174,9132,9091,9050,9009,8969,8929,8889,8850,8811,8772,8734,8696,8658,8621,
  8584,8547,8511,8475,8439,8403,8368,8333,8299,8264,8230,8197,8163,8130,8097,8065,
  8032,8000,7968,7937,7905,7874,7843};*/

HardwareSerial dxlSerial(0);

void setup() {

  dxlSerial.begin(DXL_BAUDRATE, SERIAL_8N1, RX, TX);  // Define your RX and TX pins "Feather S3 44-RX 43-TX"
  Serial.begin(115200);                               // initialize serial communication at 115200 bps, Enable CDC on Boot


  for ( int i = 0; i <= 8; i++ ) {
    Dynamixel.begin(&dxlSerial, BaudRates[i], DXL_DIR_PIN, DXL_PROTOCOL);
    Dynamixel.reset(BROADCAST_ID);
  }

  Serial.println("Done!");
  Dynamixel.begin(&dxlSerial, DXL_BAUDRATE, DXL_DIR_PIN, DXL_PROTOCOL);

  delay(1000);
}

void loop() {

  Dynamixel.setLED(DXL_ID, ON);
  delay(500);
  Dynamixel.setLED(DXL_ID, OFF);
  delay(500);
  
}
